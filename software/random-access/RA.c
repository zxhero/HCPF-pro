#ifndef _RA_#define _RA_#include"../HCPF.h"__attribute__((section(".zxhero"))) long global = -100;void TestReadWrite(){    unsigned long  begin2 = rdcycle();    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    unsigned long end2 = rdcycle();    printk("MMIO total cycle is %lx\n", end2-begin2);    begin2 = rdcycle();    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    end2 = rdcycle();    printk("MMIO total cycle is %lx\n", end2-begin2);    begin2 = rdcycle();    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    end2 = rdcycle();    printk("MMIO total cycle is %lx\n", end2-begin2);    begin2 = rdcycle();    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    end2 = rdcycle();    printk("MMIO total cycle is %lx\n", end2-begin2);    begin2 = rdcycle();    reg_write64(READ_OFFSET2,Read_Format(0,0,0));    end2 = rdcycle();    printk("MMIO total cycle is %lx\n", end2-begin2);}/*test MMIO read speed*/void testGather(){    uint64_t status = 0;uint64_t data;     status = reg_read64(READ_STATUS3);            printk("status: %lx\n",status);    printk("test gather instruction");    reg_write8(RESET_PTR,1);    reg_write8(RESET_PTR,0);    reg_write64(READ_OFFSET2, Read_Format(1,0,0));    reg_write64(REQUEST_ADDR,Get_Read_Request(8,0,0x0000000010000000,2));    reg_write64(REQUEST_ADDR,Get_Read_Request(8,2,0x0000000010000010,2));    do{            status = reg_read64(READ_STATUS2) & 3;            printk("status: %lx\n",status);    }while(status != 0x3);    data = reg_read64(READ_DATA2_L);    printk("data: %lx\n",data);    reg_write32(READ_BASE2,0x04000000);    reg_write64(READ_OFFSET2, Read_Format(3,0,0));    //printk("%lx\n",Get_Gather_Request(0,1,2,3,0,4,2,2));    reg_write64(REQUEST_ADDR, Get_Gather_Request(0,1,2,3,4,4,2,2));    do{            status = reg_read64(READ_STATUS2) & 0x3f;            printk("status: %lx\n",status);    }while(status != 0x3f);    data = reg_read64(READ_DATA2_L);    printk("data: %lx\n",data);}void Random_access(){    printk("start loop 1\n");    unsigned long begin = rdcycle();    int j;    int* p;    int sum = 0,temp=0;    for(  p = (int*)0x80000000,  j=0; j < 640;j++, p = (int*)((char*)p + 64)){  //1536        temp = *(int*)p;        sum += temp;//        sum += *((int*)p + 1);        *(int*)p = temp;        p = (int*)((char*)p + 64);        sum += *(int*)p;//        sum += *((int*)p + 1);        p = (int*)((char*)p + 64);        sum += *(int*)p;//        sum += *((int*)p + 1);    }    unsigned long end = rdcycle();    printk("%x,cache miss total cycle is %lx\n", sum, end-begin);    printk("start loop 2\n");    sum=0;    int k,h;    uint64_t data;    uint64_t status = 0;    uint64_t rdbuf_ptr = 0, wtbuf_ptr = 0;    uint64_t addr = 0x0000000010000000;    reg_write8(RESET_PTR,1);    reg_write8(RESET_PTR,0);    unsigned long  begin2 = rdcycle();    for(k = 0;k < 64;k++,rdbuf_ptr+=2,addr += 64){       reg_write64(REQUEST_ADDR,Get_Read_Request(8,rdbuf_ptr,addr,1));    }    for(k = 0;k < 64;k++,rdbuf_ptr+=2,addr += 64){       reg_write64(REQUEST_ADDR,Get_Read_Request(8,rdbuf_ptr,addr,2));    }    for(k = 0;k < 64;k++,rdbuf_ptr+=2,addr += 64){        reg_write64(REQUEST_ADDR,Get_Read_Request(8,rdbuf_ptr,addr,3));    }    for(rdbuf_ptr = 0,j = 0; j < 9;j++,rdbuf_ptr = 0){        do{            status = reg_read64(READ_STATUS3);        }while(status != 0xffffffffffffffff);        for(k=0;k<64;k++,wtbuf_ptr+=2){            data = reg_read64(READ_DATA1_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA2_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA3_L);            sum += (int) data;            sum += (data >> 32);            reg_write64(RFrequest, Get_ReadF_WB_Request(8,0,wtbuf_ptr,0));            reg_write64(RFrequest, Get_ReadF_Request(0,6));        }        for(k = 0;k < 64;k++,rdbuf_ptr+=2,addr += 64){            reg_write64(REQUEST_ADDR,Get_Read_Request(8,rdbuf_ptr,addr,1));        }        for(k = 0;k < 64;k++,rdbuf_ptr+=2,addr += 64){            reg_write64(REQUEST_ADDR,Get_Read_Request(8,rdbuf_ptr,addr,2));        }        for(k = 0;k < 64;k++,rdbuf_ptr+=2,addr += 64){            reg_write64(REQUEST_ADDR,Get_Read_Request(8,rdbuf_ptr,addr,3));        }    }    do{            status = reg_read64(READ_STATUS3);        }while(status != 0xffffffffffffffff);    for(k=0;k<64;k++){            data = reg_read64(READ_DATA1_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA2_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA3_L);            sum += (int) data;            sum += (data >> 32);            reg_write64(RFrequest, Get_ReadF_WB_Request(8,0,wtbuf_ptr,0));            reg_write64(RFrequest, Get_ReadF_Request(0,6));    }    unsigned long end2 = rdcycle();    printk("%x, MMIO total cycle is %lx\n", sum,end2-begin2);}void Random_access_gather(){    printk("start loop 1\n");    unsigned long begin = rdcycle();    int j;    int* p;    int sum = 0,temp=0;    for(  p = (int*)0x80000000,  j=0; j < 640;j++, p = (int*)((char*)p + 64)){  //1536        temp = *(int*)p;        sum += temp;//        sum += *((int*)p + 1);        *(int*)p = temp;        p = (int*)((char*)p + 64);        sum += *(int*)p;//        sum += *((int*)p + 1);        p = (int*)((char*)p + 64);        sum += *(int*)p;//        sum += *((int*)p + 1);    }    unsigned long end = rdcycle();    printk("%x,cache miss total cycle is %lx\n", sum, end-begin);    printk("start loop 2\n");    sum=0;    int k;    uint64_t data;    uint64_t status = 0,index=0;    uint64_t rdbuf_ptr = 0, wtbuf_ptr = 0;    reg_write8(RESET_PTR,1);    reg_write8(RESET_PTR,0);    unsigned long  begin2 = rdcycle();    reg_write32(READ_BASE1,0x04000000);    reg_write32(READ_BASE2,0x04000000);    reg_write32(READ_BASE3,0x04000000);    for(k = 0;k < 16;k++,rdbuf_ptr+=8,index += 4){       reg_write64(REQUEST_ADDR,Get_Gather_Request(index,index+1,index+2,index+4,rdbuf_ptr,16,2,1));    }    for(k = 0;k < 16;k++,rdbuf_ptr+=8,index += 4){       reg_write64(REQUEST_ADDR,Get_Gather_Request(index,index+1,index+2,index+4,rdbuf_ptr,16,2,2));    }    for(k = 0;k < 16;k++,rdbuf_ptr+=8,index += 4){        reg_write64(REQUEST_ADDR,Get_Gather_Request(index,index+1,index+2,index+4,rdbuf_ptr,16,2,3));    }    for(rdbuf_ptr = 0,j = 0; j < 9;j++,rdbuf_ptr = 0){        do{            status = reg_read64(READ_STATUS3);        }while(status != 0xffffffffffffffff);        for(k=0;k<64;k++,wtbuf_ptr+=2){            data = reg_read64(READ_DATA1_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA2_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA3_L);            sum += (int) data;            sum += (data >> 32);            reg_write64(RFrequest, Get_ReadF_WB_Request(8,0,wtbuf_ptr,0));            reg_write64(RFrequest, Get_ReadF_Request(0,6));        }        for(k = 0;k < 16;k++,rdbuf_ptr+=8,index += 4){            reg_write64(REQUEST_ADDR,Get_Gather_Request(index,index+1,index+2,index+4,rdbuf_ptr,16,2,1));        }        for(k = 0;k < 16;k++,rdbuf_ptr+=8,index += 4){            reg_write64(REQUEST_ADDR,Get_Gather_Request(index,index+1,index+2,index+4,rdbuf_ptr,16,2,2));        }        for(k = 0;k < 16;k++,rdbuf_ptr+=8,index += 4){            reg_write64(REQUEST_ADDR,Get_Gather_Request(index,index+1,index+2,index+4,rdbuf_ptr,16,2,3));        }    }    do{            status = reg_read64(READ_STATUS3);        }while(status != 0xffffffffffffffff);    for(k=0;k<64;k++){            data = reg_read64(READ_DATA1_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA2_L);            sum += (int) data;            sum += (data >> 32);            data = reg_read64(READ_DATA3_L);            sum += (int) data;            sum += (data >> 32);            reg_write64(RFrequest, Get_ReadF_WB_Request(8,0,wtbuf_ptr,0));            reg_write64(RFrequest, Get_ReadF_Request(0,6));    }    unsigned long end2 = rdcycle();    printk("%x, MMIO total cycle is %lx\n", sum,end2-begin2);}void CacheMissAccess(){    testGather();}void RandomAccess(){}#endif